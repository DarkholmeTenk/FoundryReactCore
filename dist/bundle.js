/*! For license information please see bundle.js.LICENSE.txt */
var FoundryReactCore;FoundryReactCore=(()=>{var e={178:(e,t,r)=>{const{mergeItemData:n}=r(386);Hooks.on("createToken",(async(e,t)=>{let{_id:r,actorId:a,actorLink:o}=t,i=game.actors.get(a);if(i.owner&&!o){let r=[],a=e=>r.push(e);Hooks.callAll("createTokenMutate",a,{scene:e,actor:i,token:t});let o=(await Promise.all(r.map((e=>e())))).filter((e=>e)),c={};if(o.forEach((e=>Object.assign(c,e))),0!==Object.keys(c).length){let r=new Token(t);if(r.scene=e,c.items){let e=n(c.items);await r.actor.createOwnedItem(e),delete c.items}await r.update(c)}}}))},894:()=>{Array.prototype.forEachAsync=function(e){return Promise.all(this.map((function(){return e(...arguments)})))},Array.prototype.forEachAsyncOrdered=async function(e){for(let t in this){if(isNaN(parseInt(t)))continue;let r=this[t];await e(r,t,this)}},Array.prototype.mapAsync=Array.prototype.forEachAsync},386:(e,t,r)=>{"use strict";r.r(t),r.d(t,{mergeItemData:()=>c});var n=r(864),a=r(202);const o=(0,n.FoundryReactCoreLogFactory)("ItemMerger");let i={data:{}};function c(e){o.debug("Merging Items",e);let t={};e.forEach((e=>{let r=e.name,n=parseInt(e.data.quantity||1),c=t[r]||[],s=c.find((({item:t})=>(0,a.isEqual)(e,t,i)));s?(o.debug("Found item for "+r,c,e),s.qty+=n):(o.debug("Not found item for "+r,c,e),c.push({item:e,qty:n})),t[r]=c}));let r=Object.values(t).flatMap((e=>e.map((({item:e,qty:t})=>{if(t==e.data.quantity||1==t)return e;{let r=(0,a.clone)(e);return delete r._id,r.data.quantity=t,r.isStack=t>1,r}}))));return o.debug("Merged items",r),r}["_id","isStack","hasUses","hasTarget","isOnCooldown","isDepleted","sort","labels","totalWeight"].forEach((e=>i[e]=!0)),["quantity"].forEach((e=>i.data[e]=!0))},864:(e,t,r)=>{"use strict";function n(e){return t=>{let r=`${e.toUpperCase()} | ${t.toUpperCase()} | `,n=function(e,...t){console.log(r+e,...t)};return n.error=function(e,...t){console.error(r+e,...t)},n.warn=function(e,...t){console.warn(r+e,...t)},n.debug=function(e,...t){console.debug(r+e,...t)},n}}r.r(t),r.d(t,{default:()=>n,FoundryReactCoreLogFactory:()=>a});const a=n("FoundryReactCore")},202:(e,t,r)=>{"use strict";r.r(t),r.d(t,{createReactElement:()=>i,randomIndex:()=>c,isEqual:()=>s,clone:()=>l});var n=r(196),a=r.n(n);let o=0;function i(e,t){let r=document.createElement("div");r.id="react-element-"+o++,e.appendChild(r),a().render(t,r)}function c(e){return Math.floor(Math.random()*e.length)}function s(e,t,r={}){if(typeof e!=typeof t)return!1;if(e===t)return!0;if(null==e)return null==t;let n=Object.keys(e).every((n=>{if(!0===r[n])return!0;let a=e[n],o=t[n];return typeof a==typeof o&&("object"==typeof a?s(a,o,r[n]||{}):a==o)})),a=Object.keys(t).some((t=>!(!0===r[t]||t in e)));return n&&!a}function l(e){if(null!==e){if(Array.isArray(e))return e.map((e=>l(e)));if("object"==typeof e){let t={};return Object.keys(e).forEach((r=>{t[r]=l(e[r])})),t}return e}}},582:(e,t,r)=>{"use strict";r.r(t),r.d(t,{Util:()=>u,default:()=>V});var n={};r.r(n),r.d(n,{default:()=>j});var a={};r.r(a),r.d(a,{SimpleReactApplication:()=>E,default:()=>x});var o={};r.r(o),r.d(o,{useGameItem:()=>I});var i={};r.r(i),r.d(i,{findFolder:()=>R,getSubFolders:()=>N,setupFolder:()=>M});var c={};r.r(c),r.d(c,{listFiles:()=>L});var s={};r.r(s),r.d(s,{loadPackItems:()=>B});var l={};r.r(l),r.d(l,{onDrop:()=>G});var u={};r.r(u),r.d(u,{AppContext:()=>n,DropHelper:()=>l,FilesHelper:()=>c,FolderHelper:()=>i,ItemHelper:()=>K,Logging:()=>w,PackHelper:()=>s,ReactApplication:()=>a,ReactHelpers:()=>o,Util:()=>S});var d=r(804),f=r(379),p=r.n(f),m=r(684);p()(m.Z,{insert:"head",singleton:!1});const h=m.Z.locals||{};var y=r(893);function g(){let[e,t]=(0,d.useState)(window.localStorage.reactDevModule);return(0,y.jsx)("div",{className:h.container,children:window.reactModules.map((({module:r,url:n})=>{let a=r===e;return(0,y.jsxs)("div",{children:[(0,y.jsx)("input",{type:"checkbox",checked:a,onChange:e=>{let n=e.target.checked;var o;o=a&&!n?null:r,window.localStorage.reactDevModule=o,t(o)}}),(0,y.jsx)("span",{children:r})," - ",(0,y.jsx)("span",{className:h.url,children:n})]})}))})}r(178);var v=r(225);p()(v.Z,{insert:"head",singleton:!1});const b=v.Z.locals||{};["itemSheet","rollTableConfig","actorSheet","scene"].forEach((e=>{Hooks.on(`render${function(e){return e.charAt(0).toUpperCase()+e.slice(1)}(e)}`,(function(t,r){let n=[];function a(e){n.push(e)}if(Hooks.callAll(`${e}MenuItems`,a,...arguments),n.length>0){let e=n.length<3;n.forEach((t=>{let n=t.name.replace(" ","-").toLowerCase(),a="."+n;n+=e?"":` ${b.shrunk}`;let o=$(`<a class="${n}" title="${t.name}">${t.icon}<div class="${b.text}">${t.name}</div></a>`);t.callback&&o.click((e=>t.callback(e))),r.closest(".app").find(a).remove();let i=r.closest(".app").find(".window-title");o.insertAfter(i)}))}}))}));var w=r(864);const{mergeItemData:A}=r(386),C=(0,w.FoundryReactCoreLogFactory)("MergeItemsButton");Hooks.on("actorSheetMenuItems",((e,t)=>{let r=t.object;r.owner&&e({name:"Merge Items",icon:'<i class="fas fa-sort-amount-up"></i>',callback:async()=>{let e=r.items.map((e=>e.data)),t=A(e),n=e.filter((e=>!t.includes(e))),a=t.filter((t=>!e.includes(t)));C("Merging",e,n,a),await r.deleteOwnedItem(n.map((e=>e._id))),await r.createOwnedItem(a)}})}));var k=r(196),O=r.n(k);const j=(0,d.createContext)(null);class x extends Application{constructor(...e){super(...e)}static get defaultOptions(){return mergeObject(super.defaultOptions,{template:"modules/FoundryReactCore/src/Util/ReactApplication.hbs"})}getComponent(){throw Error("No component defined!")}getData(e){return{id:this.appId}}async _render(...e){await super._render(...e);let t=await this.getComponent(),r=j;O().render((0,y.jsx)(r.Provider,{value:this,children:t}),document.getElementById(`react-${this.appId}`))}}class E extends x{constructor(e,...t){super(...t),this.reactComponent=e}getComponent(){return this.reactComponent}}var S=r(202);function I(e){let t=e.constructor.name,[r,n]=(0,d.useState)(e),a=(0,d.useCallback)((e=>{n(e)}),[e]);return(0,d.useEffect)((()=>(Hooks.on(`update${t}`,a),()=>Hooks.off(`update${t}`,a))),[e]),r}const _=(0,w.FoundryReactCoreLogFactory)("FolderHelper");let F=Promise.resolve();async function M(e,t="Item"){let r=F.then((async()=>{let r=e.split("/"),n=null;return await r.forEachAsyncOrdered((async r=>{let a;a=n?n.children.find((e=>e.data.name===r&&e.data.type===t)):game.folders.find((e=>e.data.name===r&&e.data.type===t)),a||(_("Creating new folder",e,r),a=await Folder.create({name:r,type:t,parent:n?n.id:null})),n=a})),n.id}));return F=r,await r}function R(e,t="Item"){let r=e.split("/"),n=!0,a=null;return r.forEach((async e=>{if(!n)return;let r;r=null==a?game.folders.find((r=>r.data.name==e&&r.data.type==t)):a.children.find((r=>r.data.name==e&&r.data.type==t)),r?a=r:(n=!1,a=null)})),a}function T(e,t){t(e),e.children.forEach((e=>T(e,t)))}function N(e){let t=R(e),r=[];return t&&T(t,(e=>r.push(e.id))),r}function H(e){let t={};return e.forEach((e=>t[e.name]=e)),t}function L({storage:e="data",target:t="",extensions:r=[],bucket:n=""}){return new Promise(((a,o)=>{game.socket.emit("manageFiles",{action:"browseFiles",storage:e,target:t},{extensions:r,bucket:n},(t=>{if(t.error)return o(t.error);let i=t.dirs.map((t=>new P({storage:e,target:t,extensions:r,bucket:n}))),c=t.files.map((e=>new D({path:e}))),s=H(i),l=H(c);a({dirs:i,files:c,dirMap:s,fileMap:l})}))}))}class P{constructor(e){this.data=e}browse(){return L(this.data)}get path(){return this.data.target}get name(){return this.path.substring(this.path.lastIndexOf("/")+1)}}class D{constructor(e){this.data=e}get path(){return this.data.path}get name(){return this.path.substring(this.path.lastIndexOf("/")+1)}}let U={};async function q(e,{failOnNoPack:t=!0}){if(U[e])return U[e];{let r=game.packs.find((t=>t.metadata.label===e));if(!r){if(t)throw Error(`No pack found with name ${e}`);return[]}let n=await r.getIndex();return U[e]=Promise.all(n.map((e=>r.getEntity(e._id)))),U[e]}}async function B(e=[],t={}){return"string"==typeof e?q(e,t):(await e.mapAsync((e=>q(e,t)))).flatMap((e=>e))}const J=(0,w.FoundryReactCoreLogFactory)("DropHelper");function G(e){return async t=>{let r=await async function(e){let t=JSON.parse(e.dataTransfer.getData("text/plain"));if(t.type){if(t.pack){J("Searching pack for id",t.pack,t.id);let e=game.packs.get(t.pack);return await e.getEntity(t.id)}{let e={Item:{cons:Item,coll:game.items},Actor:{cons:Actor,coll:game.actors},JournalEntry:{cons:Journal,coll:game.journal},Scene:{cons:Scene,coll:game.scenes},RollTable:{cons:RollTable,coll:game.tables},Macro:{cons:Macro,coll:game.macros}}[t.type];return e?t.data?new e.cons(t.data):await e.coll.get(t.id):null}}}(t);r&&e(r)}}var K=r(386);r(894),Hooks.on("renderSettings",(async()=>{setTimeout((()=>function(){if(window.isLocalhost){let e=document.getElementById("settings-game"),t=document.createElement("button");t.innerText="Change Dev Module",t.onclick=()=>new E((0,y.jsx)(g,{}),{width:500,height:700}).render(!0),e.appendChild(t)}}()),1)}));const V={loaded:!0}},225:(e,t,r)=>{"use strict";r.d(t,{Z:()=>c});var n=r(15),a=r.n(n),o=r(645),i=r.n(o)()(a());i.push([e.id,"._3CK-TEGAVuJfcF_vp_b7Sb ._17LcF9H3KNIMXclVhx26lU{display:none}._3CK-TEGAVuJfcF_vp_b7Sb:hover ._17LcF9H3KNIMXclVhx26lU{display:inline !important}._17LcF9H3KNIMXclVhx26lU{display:inline}","",{version:3,sources:["webpack://./src/Hooks/MenuButtonsHandler.module.scss"],names:[],mappings:"AAAA,kDACE,YAAA,CAGF,wDACE,yBAAA,CAGF,yBACE,cAAA",sourcesContent:[".shrunk .text{\r\n  display:none;\r\n}\r\n\r\n.shrunk:hover .text {\r\n  display: inline !important;\r\n}\r\n\r\n.text {\r\n  display: inline;\r\n}"],sourceRoot:""}]),i.locals={shrunk:"_3CK-TEGAVuJfcF_vp_b7Sb",text:"_17LcF9H3KNIMXclVhx26lU"};const c=i},684:(e,t,r)=>{"use strict";r.d(t,{Z:()=>c});var n=r(15),a=r.n(n),o=r(645),i=r.n(o)()(a());i.push([e.id,"._15eX1A39itOra8yTT9k0ID{width:100%;height:100%;overflow:auto}._2FcGodLa1PE1gzuCdwSxJm{font-size:9px}","",{version:3,sources:["webpack://./src/dev/DevSelector.module.scss"],names:[],mappings:"AAAA,yBACE,UAAA,CACA,WAAA,CACA,aAAA,CAGF,yBACE,aAAA",sourcesContent:[".container {\r\n  width: 100%;\r\n  height: 100%;\r\n  overflow: auto;\r\n}\r\n\r\n.url {\r\n  font-size: 9px;\r\n}"],sourceRoot:""}]),i.locals={container:"_15eX1A39itOra8yTT9k0ID",url:"_2FcGodLa1PE1gzuCdwSxJm"};const c=i},645:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var r=e(t);return t[2]?"@media ".concat(t[2]," {").concat(r,"}"):r})).join("")},t.i=function(e,r,n){"string"==typeof e&&(e=[[null,e,""]]);var a={};if(n)for(var o=0;o<this.length;o++){var i=this[o][0];null!=i&&(a[i]=!0)}for(var c=0;c<e.length;c++){var s=[].concat(e[c]);n&&a[s[0]]||(r&&(s[2]?s[2]="".concat(r," and ").concat(s[2]):s[2]=r),t.push(s))}},t}},15:e=>{"use strict";function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}e.exports=function(e){var r,n,a=(n=4,function(e){if(Array.isArray(e))return e}(r=e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,a=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(n=(i=c.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{n||null==c.return||c.return()}finally{if(a)throw o}}return r}}(r,n)||function(e,r){if(e){if("string"==typeof e)return t(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?t(e,r):void 0}}(r,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=a[1],i=a[3];if("function"==typeof btoa){var c=btoa(unescape(encodeURIComponent(JSON.stringify(i)))),s="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(c),l="/*# ".concat(s," */"),u=i.sources.map((function(e){return"/*# sourceURL=".concat(i.sourceRoot||"").concat(e," */")}));return[o].concat(u).concat([l]).join("\n")}return[o].join("\n")}},418:e=>{"use strict";var t=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable;function a(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},r=0;r<10;r++)t["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach((function(e){n[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(e){return!1}}()?Object.assign:function(e,o){for(var i,c,s=a(e),l=1;l<arguments.length;l++){for(var u in i=Object(arguments[l]))r.call(i,u)&&(s[u]=i[u]);if(t){c=t(i);for(var d=0;d<c.length;d++)n.call(i,c[d])&&(s[c[d]]=i[c[d]])}}return s}},251:(e,t,r)=>{"use strict";r(418);var n=r(804),a=60103;if("function"==typeof Symbol&&Symbol.for){var o=Symbol.for;a=o("react.element"),o("react.fragment")}var i=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c=Object.prototype.hasOwnProperty,s={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,r){var n,o={},l=null,u=null;for(n in void 0!==r&&(l=""+r),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(u=t.ref),t)c.call(t,n)&&!s.hasOwnProperty(n)&&(o[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===o[n]&&(o[n]=t[n]);return{$$typeof:a,type:e,key:l,ref:u,props:o,_owner:i.current}}t.jsx=l,t.jsxs=l},893:(e,t,r)=>{"use strict";e.exports=r(251)},379:(e,t,r)=>{"use strict";var n,a=function(){var e={};return function(t){if(void 0===e[t]){var r=document.querySelector(t);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}e[t]=r}return e[t]}}(),o=[];function i(e){for(var t=-1,r=0;r<o.length;r++)if(o[r].identifier===e){t=r;break}return t}function c(e,t){for(var r={},n=[],a=0;a<e.length;a++){var c=e[a],s=t.base?c[0]+t.base:c[0],l=r[s]||0,u="".concat(s," ").concat(l);r[s]=l+1;var d=i(u),f={css:c[1],media:c[2],sourceMap:c[3]};-1!==d?(o[d].references++,o[d].updater(f)):o.push({identifier:u,updater:h(f,t),references:1}),n.push(u)}return n}function s(e){var t=document.createElement("style"),n=e.attributes||{};if(void 0===n.nonce){var o=r.nc;o&&(n.nonce=o)}if(Object.keys(n).forEach((function(e){t.setAttribute(e,n[e])})),"function"==typeof e.insert)e.insert(t);else{var i=a(e.insert||"head");if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(t)}return t}var l,u=(l=[],function(e,t){return l[e]=t,l.filter(Boolean).join("\n")});function d(e,t,r,n){var a=r?"":n.media?"@media ".concat(n.media," {").concat(n.css,"}"):n.css;if(e.styleSheet)e.styleSheet.cssText=u(t,a);else{var o=document.createTextNode(a),i=e.childNodes;i[t]&&e.removeChild(i[t]),i.length?e.insertBefore(o,i[t]):e.appendChild(o)}}function f(e,t,r){var n=r.css,a=r.media,o=r.sourceMap;if(a?e.setAttribute("media",a):e.removeAttribute("media"),o&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}var p=null,m=0;function h(e,t){var r,n,a;if(t.singleton){var o=m++;r=p||(p=s(t)),n=d.bind(null,r,o,!1),a=d.bind(null,r,o,!0)}else r=s(t),n=f.bind(null,r,t),a=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(r)};return n(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n(e=t)}else a()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=(void 0===n&&(n=Boolean(window&&document&&document.all&&!window.atob)),n));var r=c(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var n=0;n<r.length;n++){var a=i(r[n]);o[a].references--}for(var s=c(e,t),l=0;l<r.length;l++){var u=i(r[l]);0===o[u].references&&(o[u].updater(),o.splice(u,1))}r=s}}}},804:e=>{"use strict";e.exports=React},196:e=>{"use strict";e.exports=ReactDOM}},t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={id:n,exports:{}};return e[n](a,a.exports,r),a.exports}return r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r(582)})();
//# sourceMappingURL=bundle.js.map